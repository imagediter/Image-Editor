<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pro Background Remover | Multi Tool Hub</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root{
    --primary:#3498db;
    --secondary:#2980b9;
    --success:#27ae60;
    --danger:#e74c3c;
    --dark:#2c3e50;
}
*{box-sizing:border-box;font-family:Inter,system-ui}
body{background:#f0f2f5;padding:20px;color:var(--dark)}
.container{max-width:1000px;margin:auto}
.header{text-align:center;margin-bottom:25px}
.header h1{font-size:2.4rem}
.main-card{background:#fff;border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,.1);overflow:hidden}

.upload-section{
    padding:35px;text-align:center;
    background:#fafafa;border-bottom:1px solid #eee;
    cursor:pointer;transition:.3s
}
.upload-section:hover{background:#eef5ff}
.upload-box{
    border:3px dashed #cbd5e0;
    padding:35px;border-radius:15px
}

.editor-grid{
    display:grid;gap:20px;padding:25px
}
@media(min-width:768px){
    .editor-grid{grid-template-columns:1fr 300px}
}

.preview-area{
    min-height:400px;
    display:flex;align-items:center;justify-content:center;
    border-radius:15px;
    background:
    linear-gradient(45deg,#ddd 25%,transparent 25%),
    linear-gradient(-45deg,#ddd 25%,transparent 25%),
    linear-gradient(45deg,transparent 75%,#ddd 75%),
    linear-gradient(-45deg,transparent 75%,#ddd 75%);
    background-size:20px 20px;
}
#main-canvas{max-width:100%;max-height:600px;border-radius:10px;display:none}

.preview-list{
    display:grid;
    grid-template-columns:repeat(auto-fill,80px);
    gap:10px;margin-top:15px
}
.thumb{
    width:80px;height:80px;
    object-fit:cover;border-radius:8px;
    border:2px solid transparent;cursor:pointer
}
.thumb.active{border-color:var(--primary)}

.controls{display:flex;flex-direction:column;gap:18px}
label{font-weight:600;font-size:.9rem}

.btn{
    padding:14px;border-radius:10px;border:none;
    font-weight:700;color:#fff;cursor:pointer;
    display:flex;align-items:center;justify-content:center;gap:8px
}
.btn-primary{background:var(--primary)}
.btn-primary:hover{background:var(--secondary)}
.btn-success{background:var(--success)}
.btn-danger{background:var(--danger)}
.btn:disabled{opacity:.5;cursor:not-allowed}

.loader{
    position:fixed;inset:0;
    display:none;align-items:center;justify-content:center;
    background:rgba(255,255,255,.8);z-index:999
}
.spinner{
    width:50px;height:50px;
    border:5px solid #eee;
    border-top:5px solid var(--primary);
    border-radius:50%;
    animation:spin 1s linear infinite
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<div class="loader" id="loader">
    <div class="spinner"></div>
</div>

<div class="container">
<div class="header">
<h1><i class="fas fa-magic" style="color:#3498db"></i> Background Remover</h1>
<p>Fast • Client-Side • No Upload</p>
</div>

<div class="main-card">

<div class="upload-section" id="drop-area">
<div class="upload-box">
<i class="fas fa-cloud-upload-alt fa-3x" style="color:#3498db"></i>
<p><strong>Drag & Drop</strong> or Click to Upload</p>
<input type="file" id="file-input" hidden multiple accept="image/*">
</div>
</div>

<div class="editor-grid">

<div>
<div class="preview-area">
<p id="placeholder">No image selected</p>
<canvas id="main-canvas"></canvas>
</div>
<div class="preview-list" id="thumb-list"></div>
</div>

<div class="controls">

<label>Sensitivity</label>
<input type="range" id="threshold" min="10" max="200" value="60">

<label>Output Format</label>
<select id="format">
<option value="png">PNG (Transparent)</option>
<option value="webp">WebP</option>
<option value="jpeg">JPEG (White BG)</option>
</select>

<button class="btn btn-primary" id="process">
<i class="fas fa-wand-magic-sparkles"></i> Remove Background
</button>

<button class="btn btn-success" id="download" disabled>
<i class="fas fa-download"></i> Download
</button>

<button class="btn btn-danger" id="reset">
<i class="fas fa-trash"></i> Reset
</button>

</div>
</div>
</div>
</div>

<script>
const fileInput=document.getElementById('file-input');
const dropArea=document.getElementById('drop-area');
const canvas=document.getElementById('main-canvas');
const ctx=canvas.getContext('2d',{willReadFrequently:true});
const thumbs=document.getElementById('thumb-list');
const loader=document.getElementById('loader');
const downloadBtn=document.getElementById('download');
const placeholder=document.getElementById('placeholder');

let images=[],current=-1;

// Upload
dropArea.onclick=()=>fileInput.click();
fileInput.onchange=e=>loadFiles(e.target.files);

function loadFiles(files){
    [...files].forEach(file=>{
        const r=new FileReader();
        r.onload=e=>{
            images.push({src:e.target.result,processed:false});
            if(current===-1)select(0);
            renderThumbs();
        };
        r.readAsDataURL(file);
    });
}

// Thumbnails
function renderThumbs(){
    thumbs.innerHTML='';
    images.forEach((img,i)=>{
        const t=document.createElement('img');
        t.src=img.src;
        t.className='thumb'+(i===current?' active':'');
        t.onclick=()=>select(i);
        thumbs.appendChild(t);
    });
}

// Select Image
function select(i){
    current=i;
    renderThumbs();
    const img=new Image();
    img.onload=()=>{
        canvas.width=img.naturalWidth;
        canvas.height=img.naturalHeight;
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(img,0,0);
        canvas.style.display='block';
        placeholder.style.display='none';
        downloadBtn.disabled=!images[i].processed;
    };
    img.src=images[i].src;
}

// Background Removal
document.getElementById('process').onclick=()=>{
    if(current<0)return;
    loader.style.display='flex';

    setTimeout(()=>{
        const t=+threshold.value;
        const imgData=ctx.getImageData(0,0,canvas.width,canvas.height);
        const d=imgData.data;

        // Average corner pixels
        let samples=[
            0, (canvas.width-1)*4,
            (canvas.height-1)*canvas.width*4,
            (canvas.width*canvas.height-1)*4
        ];
        let tr=0,tg=0,tb=0;
        samples.forEach(i=>{
            tr+=d[i];tg+=d[i+1];tb+=d[i+2];
        });
        tr/=4;tg/=4;tb/=4;

        for(let i=0;i<d.length;i+=4){
            const dist=Math.hypot(d[i]-tr,d[i+1]-tg,d[i+2]-tb);
            if(dist<t)d[i+3]=0;
        }

        ctx.putImageData(imgData,0,0);
        images[current].processed=true;
        downloadBtn.disabled=false;
        loader.style.display='none';
    },50);
};

// Download
downloadBtn.onclick=()=>{
    const format=document.getElementById('format').value;
    const link=document.createElement('a');

    if(format==='jpeg'){
        const bg=document.createElement('canvas');
        bg.width=canvas.width;
        bg.height=canvas.height;
        const bctx=bg.getContext('2d');
        bctx.fillStyle='#fff';
        bctx.fillRect(0,0,bg.width,bg.height);
        bctx.drawImage(canvas,0,0);
        link.href=bg.toDataURL('image/jpeg',0.9);
    }else{
        link.href=canvas.toDataURL(`image/${format}`,0.9);
    }
    link.download=`bg-removed-${Date.now()}.${format}`;
    link.click();
};

// Reset
document.getElementById('reset').onclick=()=>{
    images=[];current=-1;
    thumbs.innerHTML='';
    ctx.clearRect(0,0,canvas.width,canvas.height);
    canvas.style.display='none';
    placeholder.style.display='block';
    downloadBtn.disabled=true;
};

// Drag & Drop
dropArea.ondragover=e=>{e.preventDefault();};
dropArea.ondrop=e=>{
    e.preventDefault();
    loadFiles(e.dataTransfer.files);
};
</script>

</body>
</html>
