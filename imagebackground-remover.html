<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pro Background Remover | Multi Tool Hub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2980b9;
            --accent: #8e44ad;
            --success: #27ae60;
            --danger: #e74c3c;
            --light: #f8f9fa;
            --dark: #2c3e50;
        }

        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Inter', sans-serif; }
        body { background: #f0f2f5; color: var(--dark); padding: 20px; }
        .container { max-width: 1000px; margin: auto; }

        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 2.5rem; color: var(--dark); margin-bottom: 10px; }
        .header p { color: #666; }

        .main-card { background: #fff; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); overflow: hidden; }
        
        .upload-section { 
            padding: 40px; border-bottom: 1px solid #eee; text-align: center; 
            background: #fafafa; cursor: pointer; transition: 0.3s;
        }
        .upload-section:hover { background: #f1f7ff; }
        .upload-box { border: 3px dashed #cbd5e0; padding: 40px; border-radius: 15px; }

        .editor-grid { display: grid; grid-template-columns: 1fr; gap: 20px; padding: 25px; }
        @media (min-width: 768px) { .editor-grid { grid-template-columns: 1fr 300px; } }

        .preview-area { 
            background: #eee; border-radius: 15px; min-height: 400px; 
            display: flex; align-items: center; justify-content: center;
            background-image: linear-gradient(45deg, #ddd 25%, transparent 25%), 
                              linear-gradient(-45deg, #ddd 25%, transparent 25%), 
                              linear-gradient(45deg, transparent 75%, #ddd 75%), 
                              linear-gradient(-45deg, transparent 75%, #ddd 75%);
            background-size: 20px 20px; background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        .preview-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; margin-top: 20px; }
        .thumb { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; border: 2px solid transparent; cursor: pointer; }
        .thumb.active { border-color: var(--primary); }

        .controls { display: flex; flex-direction: column; gap: 20px; }
        .control-group { display: flex; flex-direction: column; gap: 8px; }
        label { font-weight: 600; font-size: 0.9rem; color: #555; }

        input[type="range"] { width: 100%; cursor: pointer; }
        select { padding: 10px; border-radius: 8px; border: 1px solid #ddd; outline: none; }

        .btn { 
            padding: 15px; border: none; border-radius: 10px; font-weight: bold; 
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: 0.2s; color: white;
        }
        .btn-primary { background: var(--primary); }
        .btn-primary:hover { background: var(--secondary); }
        .btn-success { background: var(--success); }
        .btn-danger { background: var(--danger); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        #main-canvas { max-width: 100%; max-height: 600px; border-radius: 10px; display: none; }
        #placeholder-text { color: #888; text-align: center; }

        .loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.8); display: none;
            flex-direction: column; align-items: center; justify-content: center; z-index: 1000;
        }
        .spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="loader" id="loader">
    <div class="spinner"></div>
    <p style="margin-top: 15px; font-weight: bold;">Processing Image...</p>
</div>

<div class="container">
    <div class="header">
        <h1><i class="fas fa-magic" style="color: var(--primary);"></i> BG Remover</h1>
        <p>Upload your images and remove backgrounds instantly.</p>
    </div>

    <div class="main-card">
        <div class="upload-section" id="drop-area">
            <div class="upload-box">
                <i class="fas fa-cloud-upload-alt fa-3x" style="color: var(--primary); margin-bottom: 15px;"></i>
                <p>Drag & Drop or <strong>Browse Files</strong></p>
                <input type="file" id="file-input" hidden multiple accept="image/*">
            </div>
        </div>

        <div class="editor-grid">
            <div class="workspace">
                <div class="preview-area">
                    <p id="placeholder-text">No image selected</p>
                    <canvas id="main-canvas"></canvas>
                </div>
                <div class="preview-list" id="thumb-list"></div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label>Sensitivity (Color Distance)</label>
                    <input type="range" id="threshold" min="1" max="150" value="40">
                </div>

                <div class="control-group">
                    <label>Output Format</label>
                    <select id="format">
                        <option value="png">PNG (Transparent)</option>
                        <option value="webp">WebP</option>
                        <option value="jpeg">JPEG (White BG)</option>
                    </select>
                </div>

                <button class="btn btn-primary" id="process-btn"><i class="fas fa-wand-magic-sparkles"></i> Remove Background</button>
                <button class="btn btn-success" id="download-btn" disabled><i class="fas fa-download"></i> Download Image</button>
                <button class="btn btn-danger" id="reset-btn"><i class="fas fa-trash"></i> Reset All</button>
            </div>
        </div>
    </div>
</div>

<script>
    const fileInput = document.getElementById('file-input');
    const dropArea = document.getElementById('drop-area');
    const thumbList = document.getElementById('thumb-list');
    const canvas = document.getElementById('main-canvas');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });
    const processBtn = document.getElementById('process-btn');
    const downloadBtn = document.getElementById('download-btn');
    const placeholder = document.getElementById('placeholder-text');
    const loader = document.getElementById('loader');

    let imageQueue = [];
    let currentIndex = -1;

    // Trigger File Selection
    dropArea.onclick = () => fileInput.click();

    fileInput.onchange = (e) => handleFiles(e.target.files);

    function handleFiles(files) {
        Array.from(files).forEach(file => {
            const reader = new FileReader();
            reader.onload = (f) => {
                const imgObj = { src: f.target.result, name: file.name, processed: false };
                imageQueue.push(imgObj);
                renderThumbs();
                if (currentIndex === -1) selectImage(0);
            };
            reader.readAsDataURL(file);
        });
    }

    function renderThumbs() {
        thumbList.innerHTML = '';
        imageQueue.forEach((img, index) => {
            const el = document.createElement('img');
            el.src = img.src;
            el.className = `thumb ${index === currentIndex ? 'active' : ''}`;
            el.onclick = () => selectImage(index);
            thumbList.appendChild(el);
        });
    }

    function selectImage(index) {
        currentIndex = index;
        renderThumbs();
        const img = new Image();
        img.src = imageQueue[index].src;
        img.onload = () => {
            placeholder.style.display = 'none';
            canvas.style.display = 'block';
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            downloadBtn.disabled = !imageQueue[index].processed;
        };
    }

    processBtn.onclick = () => {
        if (currentIndex === -1) return;
        loader.style.display = 'flex';

        // Set timeout to allow UI to show loader
        setTimeout(() => {
            const threshold = parseInt(document.getElementById('threshold').value);
            const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imgData.data;

            // Simple Auto-Detect Background Color (Top-Left Pixel)
            const rTarget = data[0];
            const gTarget = data[1];
            const bTarget = data[2];

            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i+1];
                const b = data[i+2];

                // Calculate color distance (Euclidean)
                const distance = Math.sqrt(
                    Math.pow(r - rTarget, 2) + 
                    Math.pow(g - gTarget, 2) + 
                    Math.pow(b - bTarget, 2)
                );

                if (distance < threshold) {
                    data[i + 3] = 0; // Set Alpha to Transparent
                }
            }

            ctx.putImageData(imgData, 0, 0);
            imageQueue[currentIndex].processed = true;
            downloadBtn.disabled = false;
            loader.style.display = 'none';
        }, 100);
    };

    downloadBtn.onclick = () => {
        const format = document.getElementById('format').value;
        const link = document.createElement('a');
        link.download = `removed-bg-${Date.now()}.${format}`;
        link.href = canvas.toDataURL(`image/${format === 'jpeg' ? 'jpeg' : 'png'}`, 0.9);
        link.click();
    };

    document.getElementById('reset-btn').onclick = () => {
        imageQueue = [];
        currentIndex = -1;
        thumbList.innerHTML = '';
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        canvas.style.display = 'none';
        placeholder.style.display = 'block';
        downloadBtn.disabled = true;
    };

    // Drag and Drop support
    dropArea.addEventListener('dragover', (e) => { e.preventDefault(); dropArea.style.background = "#eef2ff"; });
    dropArea.addEventListener('dragleave', () => { dropArea.style.background = "#fafafa"; });
    dropArea.addEventListener('drop', (e) => {
        e.preventDefault();
        dropArea.style.background = "#fafafa";
        handleFiles(e.dataTransfer.files);
    });
</script>

</body>
</html>
